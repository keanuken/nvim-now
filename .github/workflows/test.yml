name: Test Neovim Configuration

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        neovim-version: ['v0.9.0', 'v0.10.0', 'nightly']
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install Neovim
      uses: rhysd/action-setup-vim@v1
      with:
        version: ${{ matrix.neovim-version }}
        neovim: true
    
    - name: Check Neovim version
      run: nvim --version
    
    - name: Validate init.lua syntax
      run: |
        luac -p init.lua
        echo "Checking Lua syntax in lua/ directory..."
        find lua/ -name "*.lua" -exec luac -p {} \;
    
    - name: Test configuration startup
      run: |
        # Start Neovim in headless mode to test if config loads without errors
        nvim -E -c 'try | lua require("core") | catch | echom v:exception | cquit | endtry' || exit 1
        nvim --headless -c 'quitall!' 2>&1 | grep -v "WARNING" || true